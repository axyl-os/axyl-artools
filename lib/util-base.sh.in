#!/bin/bash
#
# Copyright (C) 2018-19 artoo@artixlinux.org
# Copyright (C) 2018 Artix Linux Developers
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

CHROOTVERSION=@chroot_version@

. @datadir@/makepkg/util.sh

DATADIR=${DATADIR:-'@datadir@/artools'}
LIBDIR=${LIBDIR:-'@libdir@/artools'}
SYSCONFDIR=${SYSCONFDIR:-'@sysconfdir@/artools'}

for baselib in ${LIBDIR}/base/*.sh; do
    . $baselib
done

load_user_info(){
    OWNER=${SUDO_USER:-$USER}

    if [[ -n $SUDO_USER ]]; then
        eval "USER_HOME=~$SUDO_USER"
    else
        USER_HOME=$HOME
    fi

    XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$USER_HOME/.config}"

    USER_CONF_DIR="${XDG_CONFIG_HOME}/artools"

    prepare_dir "${USER_CONF_DIR}"

    USER_CACHE_DIR="${XDG_CACHE_HOME:-$USER_HOME/.cache}/artools"
}

load_base_config(){

    local conf="$1/artools-base.conf"

    [[ -f "$conf" ]] || return 1

    [[ -r "$conf" ]] && . "$conf"


    ARCH=$(uname -m)

    CHROOTS_DIR=${CHROOTS_DIR:-'/var/lib/artools'}

    WORKSPACE_DIR=${WORKSPACE_DIR:-"/home/${OWNER}/artools-workspace"}

    prepare_dir "${WORKSPACE_DIR}"

    return 0
}

load_user_info

load_base_config "${USER_CONF_DIR}" || load_base_config "${SYSCONFDIR}"
