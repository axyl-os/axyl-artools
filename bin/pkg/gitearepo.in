#!/bin/bash
#
# Copyright (C) 2018-21 artoo@artixlinux.org
# Copyright (C) 2021 Artix Linux Developers
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

m4_include(lib/util-base.sh)
m4_include(lib/util-pkg.sh)
m4_include(lib/base/message.sh)
m4_include(lib/pkg/common.sh)
m4_include(lib/pkg/gitea.sh)

usage() {
    echo "Usage: ${0##*/} [options]"
    echo '    -p <repo>     Repo name'
    echo '    -t <team>     Team name'
    echo '    -c            Create git repo'
    echo '    -a            Add team to git repo'
    echo '    -r            Remove team from git repo'
    echo '    -m            Transfer git repo to landfill org'
    echo '    -h            This help'
    echo ''
    echo ''
    exit "$1"
}

create=false
add=false
remove=false
transfer=false

opts='p:t:carmh'

while getopts "${opts}" arg; do
    case "${arg}" in
        p) repo="$OPTARG" ;;
        t) team="$OPTARG" ;;
        c) create=true ;;
        a) add=true ;;
        r) remove=true ;;
        m) transfer=true ;;
        h|?) usage 0 ;;
        *) echo "invalid argument '${arg}'"; usage 1 ;;
    esac
done

shift $(( OPTIND - 1 ))

org=$(get_pkg_org "${repo}")

${create} && create_repo "${repo}" "${org}"

${transfer} && transfer_repo "${repo}" "${org}"

${add} && add_team_to_repo "${repo}" "${org}" "${team}"

${remove} && remove_team_from_repo "${repo}" "${org}" "${team}"
