#!/bin/bash
#
# Copyright (C) 2018-19 artoo@artixlinux.org
# Copyright (C) 2018 Artix Linux Developers
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

. @libdir@/artools/util-pkg.sh

batch_move() {
    local name="$1"
    local pkglist=${TREE_DIR_ARTIX}/$name.list
    [[ -f $pkglist ]] || die "${name}.list does not exist!"
    while read entry;do
        local pkg=${entry##*:}
        local src=${entry%:*}
        src=${src#*:}
        local dest=${entry%%:*}
        echo "${dest}pkg -s ${src} -u -p ${pkg}"
    done < $pkglist
}

# batch_upgrade() {
#     local pkglist=${TREE_DIR_ARTIX}/pkg_upgrades.list
#     [[ -f $pkglist ]] || die "pkg_upgrades.list does not exist!"
#     while read entry;do
#         local pkg=${entry#*:}
#         local dest=${entry%:*}
#         echo "buildtree -i -p ${pkg}"
#         echo "${dest}pkg -u -p ${pkg}"
#     done < $pkglist
# }

usage() {
    echo "Usage: ${0##*/} [optional listname]"
#     echo "    -m                 Batch move"
#     echo "    -u                 Batch upgrade"
    echo '    -h                 This help'
    echo ''
    echo ''
    exit $1
}

load_user_info

load_pkg_config "${USER_CONF_DIR}" || load_pkg_config "${SYSCONFDIR}"

# move=false
# upgrade=false
movelistname='pkg_moves'

opts='h'

while getopts "${opts}" arg; do
    case "${arg}" in
#         m) move=true ;;
#         u) upgrade=true ;;
        h|?) usage 0 ;;
        *) echo "invalid argument '${arg}'"; usage 1 ;;
    esac
done

shift $(($OPTIND - 1))

movelistname="$1"; shift

# if ${move}; then
#     batch_move
# elif ${upgrade};then
#     batch_upgrade
# fi

batch_move "$movelistname"
